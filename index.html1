<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Tic Tac Toe — Static (with AI + Startup options)</title>
  <style>
    :root{
      --bg:#0f1724; --muted:#94a3b8; --glass: rgba(255,255,255,0.03);
      --accent:#08a0e9; --card:#071027;
      font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, Arial, sans-serif;
    }
    html,body{height:100%;margin:0;background:
      radial-gradient(1200px 600px at 10% 10%, rgba(8,160,233,0.04), transparent 8%),
      linear-gradient(180deg,#071025 0%, #031026 100%), var(--bg);
      color:#e6eef6; -webkit-font-smoothing:antialiased;}

    .wrap{min-height:100%;display:flex;align-items:center;justify-content:center;padding:28px;box-sizing:border-box}
    .card{width:100%;max-width:920px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.03));border-radius:14px;padding:20px;box-shadow:0 8px 30px rgba(2,6,23,0.6);display:grid;grid-template-columns:1fr 360px;gap:18px;align-items:start}
    @media (max-width:920px){.card{grid-template-columns:1fr}}

    header{grid-column:1 / -1;display:flex;align-items:center;justify-content:space-between;gap:12px;margin-bottom:6px}
    h1{font-size:20px;margin:0}
    .sub{color:var(--muted);font-size:13px}

    .board-wrap{background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.02));padding:18px;border-radius:10px;display:flex;flex-direction:column;gap:14px;align-items:center;justify-content:center}
    .board{width:320px;max-width:calc(100vw - 120px);aspect-ratio:1;display:grid;grid-template-columns:repeat(3,1fr);grid-template-rows:repeat(3,1fr);gap:10px;padding:10px;box-sizing:border-box;border-radius:10px}
    .cell{background:var(--glass);border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:56px;font-weight:700;user-select:none;cursor:pointer;transition:transform .12s,box-shadow .12s;position:relative;color:#e6eef6;outline:none}
    .cell:active{transform:scale(.98)}
    .cell[aria-disabled="true"]{cursor:not-allowed;opacity:.9}
    .cell.x{color:#eab308}.cell.o{color:#60a5fa}

    .controls{display:flex;gap:10px;align-items:center;justify-content:center;width:100%}
    button{background:transparent;border:1px solid rgba(255,255,255,0.06);color:inherit;padding:8px 12px;border-radius:10px;cursor:pointer;font-weight:600;letter-spacing:.2px;transition:all .14s}
    .btn-primary{background:linear-gradient(90deg, rgba(8,160,233,0.12), rgba(16,185,129,0.06));border:1px solid rgba(255,255,255,0.06);box-shadow:0 6px 18px rgba(8,160,233,0.06)}
    .side{background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(0,0,0,0.02));padding:16px;border-radius:10px;display:flex;flex-direction:column;gap:12px;min-height:200px}
    .status{font-size:15px;font-weight:700;display:flex;align-items:center;gap:8px}
    .muted{color:var(--muted);font-weight:500;font-size:13px}
    .score{display:flex;gap:8px;align-items:center;justify-content:space-between;background:rgba(255,255,255,0.02);padding:10px;border-radius:8px;font-weight:700}
    .score .who{font-size:13px;color:var(--muted);font-weight:600}
    .win .cell{opacity:.25;transform:scale(.98)} .win .cell.win-cell{opacity:1;transform:scale(1.03);box-shadow:0 12px 30px rgba(16,185,129,0.08)}
    footer{grid-column:1 / -1;font-size:12px;color:var(--muted);display:flex;justify-content:space-between;gap:8px;align-items:center;margin-top:6px}
    .small{font-size:12px;color:var(--muted)}

    /* modal */
    .modal-backdrop{position:fixed;inset:0;background:linear-gradient(0deg, rgba(2,6,23,0.6), rgba(2,6,23,0.6));display:flex;align-items:center;justify-content:center;z-index:50}
    .modal{width:100%;max-width:520px;background:linear-gradient(180deg,#061126,#0b1420);border-radius:12px;padding:18px;box-shadow:0 20px 60px rgba(0,0,0,0.6);border:1px solid rgba(255,255,255,0.03)}
    .modal h2{margin:0 0 6px 0}
    .form-row{display:flex;gap:8px;align-items:center;margin:8px 0;flex-wrap:wrap}
    label.inline{font-size:13px;color:var(--muted);display:flex;gap:8px;align-items:center}
    select, input[type="radio"], input[type="button"]{margin-left:6px}
    .muted-small{font-size:12px;color:var(--muted)}
    .center{display:flex;justify-content:center;gap:8px;margin-top:12px}
    input[type="button"].start{padding:10px 14px;border-radius:10px;background:linear-gradient(90deg,#08a0e9,#10b981);border:none;color:#041022;font-weight:800;cursor:pointer}
    input[type="button"].start:hover{transform:translateY(-3px)}
    .hint{font-size:12px;color:var(--muted);margin-top:6px}
    /* focus */
    .cell:focus{box-shadow:0 0 0 3px rgba(8,160,233,.12), 0 6px 18px rgba(2,6,23,.6);outline:none}
  </style>
</head>
<body>
  <!-- Modal: shown on load -->
  <div id="modal" class="modal-backdrop" role="dialog" aria-modal="true" aria-label="Game setup">
    <div class="modal" role="document">
      <h2>Start new game</h2>
      <div class="muted-small">Choose mode, AI difficulty (if any), which mark you want, and who starts.</div>

      <div class="form-row" style="margin-top:12px">
        <label class="inline">Mode:
          <select id="modalMode" aria-label="Game mode">
            <option value="hvh">Human vs Human</option>
            <option value="hva">Human vs AI</option>
          </select>
        </label>

        <label class="inline" id="diffWrap">AI Difficulty:
          <select id="modalAiLevel" aria-label="AI difficulty">
            <option value="easy">Easy (random)</option>
            <option value="hard">Hard (optimal)</option>
          </select>
        </label>
      </div>

      <div class="form-row">
        <label class="inline">You play as:
          <select id="modalHumanMark" aria-label="Human mark">
            <option value="X">X</option>
            <option value="O">O</option>
          </select>
        </label>

        <label class="inline">Starter (mark):
          <select id="modalStarter" aria-label="Starter mark">
            <option value="X">X</option>
            <option value="O">O</option>
          </select>
        </label>
      </div>

      <div class="hint">Tip: If you want the AI to start first, set "You play as" to the other mark and choose the starter to be the AI's mark.</div>

      <div class="center">
        <input type="button" class="start" id="startBtn" value="Start Game">
        <input type="button" id="cancelBtn" value="Cancel">
      </div>
    </div>
  </div>

  <div class="wrap">
    <div class="card" role="application" aria-label="Tic tac toe game">
      <header>
        <div>
          <h1>Tic Tac Toe (with AI)</h1>
          <div class="sub">Single-file — drop into GitHub Pages. Keyboard: arrows + Enter, 'r' to restart.</div>
        </div>
        <div class="sub">Choose settings when the app opens.</div>
      </header>

      <section class="board-wrap" aria-labelledby="boardTitle">
        <div id="boardTitle" class="muted" style="width:100%; text-align:left">Game board</div>
        <div class="board" id="board" role="grid" aria-label="tic tac toe grid"></div>

        <div class="controls" aria-hidden="false">
          <button id="restart" class="btn-primary" title="Restart game">Restart</button>
          <button id="resetScore" title="Reset scoreboard">Reset Scores</button>
          <button id="openSettings" title="Open settings">Open Settings</button>
        </div>
      </section>

      <aside class="side" aria-labelledby="panelTitle">
        <div id="panelTitle" class="status">Status: <span id="statusText" style="margin-left:6px">—</span></div>

        <div style="display:flex;gap:8px;flex-direction:column">
          <div class="score" aria-live="polite">
            <div><div class="who">X</div><div id="scoreX" style="font-size:20px">0</div></div>
            <div style="text-align:center;color:var(--muted);font-size:13px">Draws<br><span id="scoreD" style="font-size:18px">0</span></div>
            <div><div class="who">O</div><div id="scoreO" style="font-size:20px">0</div></div>
          </div>
          <div class="muted">How to play: take turns placing X and O. First to line up 3 wins.</div>
        </div>
      </aside>

      <footer>
        <div class="small">No external libs • Accessible • Mobile friendly</div>
        <div class="small">Save as <code>index.html</code> and push to GitHub</div>
      </footer>
    </div>
  </div>

<script>
/*
  Tic Tac Toe single-file with startup modal for settings:
  - Mode: Human vs Human / Human vs AI
  - If Human vs AI: AI difficulty (easy/hard)
  - Human chooses mark (X or O)
  - Starter: X or O (who moves first)
  Behavior:
    - Human mark determines which side human plays.
    - Starter determines the initial current player; if the starter is AI and mode is H vs A, AI moves immediately.
*/

(function(){
  const BOARD = document.getElementById('board');
  const STATUS = document.getElementById('statusText');
  const RESTART = document.getElementById('restart');
  const RESET_SCORE = document.getElementById('resetScore');
  const OPEN_SETTINGS = document.getElementById('openSettings');
  const SCORE_X = document.getElementById('scoreX');
  const SCORE_O = document.getElementById('scoreO');
  const SCORE_D = document.getElementById('scoreD');

  // Modal elements
  const MODAL = document.getElementById('modal');
  const MODAL_MODE = document.getElementById('modalMode');
  const MODAL_AILEVEL = document.getElementById('modalAiLevel');
  const MODAL_HUMAN_MARK = document.getElementById('modalHumanMark');
  const MODAL_STARTER = document.getElementById('modalStarter');
  const START_BTN = document.getElementById('startBtn');
  const CANCEL_BTN = document.getElementById('cancelBtn');
  const DIFF_WRAP = document.getElementById('diffWrap');

  // Game variables
  let cells = Array(9).fill(null);
  let current = 'X';
  let running = false;
  let humanPlays = { X: true, O: true }; // will be set by modal
  let aiLevel = 'hard';
  let mode = 'hvh'; // 'hvh' or 'hva'
  const LINES = [
    [0,1,2],[3,4,5],[6,7,8],
    [0,3,6],[1,4,7],[2,5,8],
    [0,4,8],[2,4,6]
  ];

  // Scores using localStorage
  function loadScores(){ const s = JSON.parse(localStorage.getItem('ttt-scores') || '{}'); return { X: s.X || 0, O: s.O || 0, D: s.D || 0 }; }
  function saveScores(scores){ localStorage.setItem('ttt-scores', JSON.stringify(scores)); renderScores(scores); }
  function renderScores(scores){ SCORE_X.textContent = scores.X; SCORE_O.textContent = scores.O; SCORE_D.textContent = scores.D; }

  // Build board
  function buildBoard(){
    BOARD.innerHTML = '';
    for(let i=0;i<9;i++){
      const btn = document.createElement('button');
      btn.className = 'cell';
      btn.setAttribute('role','gridcell');
      btn.setAttribute('aria-label',`cell ${i+1}`);
      btn.dataset.index = i;
      btn.tabIndex = 0;
      btn.addEventListener('click', onCellClick);
      btn.addEventListener('keydown', onCellKeydown);
      BOARD.appendChild(btn);
    }
    // focus first
    const first = BOARD.querySelector('.cell');
    if(first) first.focus();
  }

  function onCellClick(e){
    const idx = Number(e.currentTarget.dataset.index);
    playAt(idx);
  }

  function onCellKeydown(e){
    const idx = Number(e.currentTarget.dataset.index);
    const key = e.key;
    let next;
    if(key === 'ArrowRight') next = (idx % 3 === 2) ? idx - 2 : idx + 1;
    else if(key === 'ArrowLeft') next = (idx % 3 === 0) ? idx + 2 : idx - 1;
    else if(key === 'ArrowDown') next = (idx + 3) % 9;
    else if(key === 'ArrowUp') next = (idx + 6) % 9;
    else if(key === 'Enter' || key === ' '){ e.preventDefault(); playAt(idx); return; } else return;

    e.preventDefault();
    const nextCell = BOARD.querySelector(\`.cell[data-index="\${next}"]\`);
    if(nextCell) nextCell.focus();
  }

  function playAt(index){
    if(!running) return;
    if(cells[index]) return;
    if(!humanPlays[current]) return; // prevent clicking when it's AI's turn

    placeMark(index, current);

    const result = checkWin();
    if(result.winner){ handleWin(result.winner, result.line); return; }
    if(result.draw){ handleDraw(); return; }

    current = current === 'X' ? 'O' : 'X';
    STATUS.textContent = current + "'s turn";

    if(!humanPlays[current] && running){
      setTimeout(() => aiMove(), 250);
    }
  }

  function placeMark(index, mark){
    cells[index] = mark;
    const el = BOARD.querySelector(\`.cell[data-index="\${index}"]\`);
    el.classList.add(mark.toLowerCase());
    el.textContent = mark;
    el.setAttribute('aria-disabled','true');
  }

  function checkWin(){
    for(const line of LINES){
      const [a,b,c] = line;
      if(cells[a] && cells[a] === cells[b] && cells[a] === cells[c]){
        return { winner: cells[a], line };
      }
    }
    if(cells.every(Boolean)) return { draw: true };
    return {};
  }

  function handleWin(winner, line){
    running = false;
    STATUS.textContent = winner + ' wins!';
    BOARD.classList.add('win');
    for(const cellEl of BOARD.querySelectorAll('.cell')) cellEl.setAttribute('aria-disabled','true');
    for(const idx of line){ const el = BOARD.querySelector(\`.cell[data-index="\${idx}"]\`); el.classList.add('win-cell'); }
    const scores = loadScores(); scores[winner] = (scores[winner] || 0) + 1; saveScores(scores);
  }

  function handleDraw(){
    running = false;
    STATUS.textContent = 'Draw!';
    const scores = loadScores(); scores.D = (scores.D || 0) + 1; saveScores(scores);
    for(const cellEl of BOARD.querySelectorAll('.cell')) cellEl.setAttribute('aria-disabled','true');
  }

  function restartGame(keepSettings){
    // if keepSettings false, open settings modal
    if(!keepSettings){
      openModal();
      return;
    }
    cells = Array(9).fill(null);
    BOARD.classList.remove('win');
    buildBoard();
    running = true;
    current = MODAL_STARTER.value; // use values from last chosen settings stored in modal selects
    STATUS.textContent = current + "'s turn";
    // if AI starts and playing mode is H vs A, trigger AI
    if(mode === 'hva' && !humanPlays[current]){
      setTimeout(() => aiMove(), 350);
    }
  }

  // AI dispatcher
  function aiMove(){
    if(!running) return;
    const empties = cells.map((v,i)=> v ? null : i).filter(v=>v!==null);
    if(empties.length === 0) return;
    let idx;
    if(aiLevel === 'easy'){
      idx = empties[Math.floor(Math.random() * empties.length)];
    } else {
      idx = bestMove(cells.slice(), current);
    }
    placeMark(idx, current);
    const result = checkWin();
    if(result.winner){ handleWin(result.winner, result.line); return; }
    if(result.draw){ handleDraw(); return; }
    current = current === 'X' ? 'O' : 'X';
    STATUS.textContent = current + "'s turn";
  }

  // Minimax for optimal play
  function bestMove(boardState, playerMark){
    const opponent = playerMark === 'X' ? 'O' : 'X';
    if(boardState.every(v => !v)) return 4; // center
    function winnerFor(b){
      for(const line of LINES){
        const [a,b1,c] = line;
        if(b[a] && b[a] === b[b1] && b[a] === b[c]) return b[a];
      }
      if(b.every(Boolean)) return 'draw';
      return null;
    }
    function minimax(b, turn){
      const w = winnerFor(b);
      if(w === playerMark) return { score: 10 };
      if(w === opponent) return { score: -10 };
      if(w === 'draw') return { score: 0 };
      const moves = [];
      for(let i=0;i<9;i++){
        if(!b[i]){
          b[i] = turn;
          const res = minimax(b, turn === 'X' ? 'O' : 'X');
          moves.push({ index: i, score: res.score });
          b[i] = null;
        }
      }
      if(turn === playerMark){
        let best = moves[0];
        for(const m of moves) if(m.score > best.score) best = m;
        return best;
      } else {
        let best = moves[0];
        for(const m of moves) if(m.score < best.score) best = m;
        return best;
      }
    }
    const best = minimax(boardState, playerMark);
    return best.index;
  }

  // Modal / settings handling
  function openModal(){
    MODAL.style.display = 'flex';
    // reflect current values into modal selects
    MODAL_MODE.value = mode;
    MODAL_AILEVEL.value = aiLevel;
    MODAL_HUMAN_MARK.value = humanPlays.X && !humanPlays.O ? 'X' : (!humanPlays.X && humanPlays.O ? 'O' : MODAL_HUMAN_MARK.value);
    // starter select retains previous
    // show/hide AI difficulty depending on mode
    DIFF_WRAP.style.display = (MODAL_MODE.value === 'hva') ? 'inline-flex' : 'none';
    // focus
    START_BTN.focus();
  }

  function closeModal(){
    MODAL.style.display = 'none';
  }

  // Apply modal choices and start the game
  START_BTN.addEventListener('click', () => {
    mode = MODAL_MODE.value;
    aiLevel = MODAL_AILEVEL.value;
    const humanMark = MODAL_HUMAN_MARK.value; // 'X' or 'O'
    const starterMark = MODAL_STARTER.value; // 'X' or 'O'

    if(mode === 'hvh'){
      humanPlays = { X: true, O: true };
    } else {
      humanPlays = { X: humanMark === 'X', O: humanMark === 'O' };
    }

    // store current starter in modalStarter select (used by restart)
    MODAL_STARTER.value = starterMark;

    // save modal values so restart keeps them
    // init game
    closeModal();
    // prepare and start
    cells = Array(9).fill(null);
    BOARD.classList.remove('win');
    buildBoard();
    running = true;
    current = starterMark;
    STATUS.textContent = current + "'s turn";
    // if AI should move first
    if(mode === 'hva' && !humanPlays[current]){
      setTimeout(() => aiMove(), 350);
    }
  });

  // Cancel opens but returns to modal closed and waiting (we'll simply close modal but do not start)
  CANCEL_BTN.addEventListener('click', () => {
    // If there is an existing game running, just close settings, otherwise keep modal open to enforce selection
    closeModal();
    // If there is no game yet, reopen modal so user must choose. But to be friendly, we reopen only if we never started.
    if(!running){
      // reopen after tiny delay so user can cancel intentionally
      setTimeout(() => openModal(), 120);
    }
  });

  // Toggle AI difficulty visibility
  MODAL_MODE.addEventListener('change', () => { DIFF_WRAP.style.display = (MODAL_MODE.value === 'hva') ? 'inline-flex' : 'none'; });

  // Buttons
  RESTART.addEventListener('click', () => restartGame(true));
  RESET_SCORE.addEventListener('click', () => { const zero = { X:0, O:0, D:0 }; saveScores(zero); });
  OPEN_SETTINGS.addEventListener('click', () => openModal());

  // Init UI
  (function init(){
    buildBoard();
    renderScores(loadScores());
    // set defaults in modal
    MODAL_MODE.value = 'hva';
    MODAL_AILEVEL.value = 'hard';
    MODAL_HUMAN_MARK.value = 'X';
    MODAL_STARTER.value = 'X';
    DIFF_WRAP.style.display = 'inline-flex';
    // show modal to force user pick settings
    openModal();
    // keyboard 'r' restarts
    window.addEventListener('keydown', (e) => { if(e.key === 'r' || e.key === 'R'){ restartGame(true); } });
  })();

})();
</script>
</body>
</html>
